<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Generics (generics.Generics)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">generics</a> &#x00BB; Generics</nav><header class="odoc-preamble"><h1>Module <code><span>Generics</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#basic-types">Basic types</a></li><li><a href="#records">Records</a></li><li><a href="#variants">Variants</a></li><li><a href="#abstract-types">Abstract types</a></li><li><a href="#dynamic-types">Dynamic types</a></li><li><a href="#type-equality">Type equality</a></li><li><a href="#mapper">Mapper</a><ul><li><a href="#custom-mappers">Custom mappers</a></li></ul></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-typ" class="anchored"><a href="#type-typ" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a typ</span></span></code></div><div class="spec-doc"><p>The type for runtime representation of types.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-dyn" class="anchored"><a href="#type-dyn" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a dyn</span></span><span> = <span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> * <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>The type for dynamic values, i.e., values with a type representation.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-any" class="anchored"><a href="#type-any" class="anchor"></a><code><span><span class="keyword">type</span> any</span><span> = </span></code><table><tr id="type-any.Any" class="anchored"><td class="def variant constructor"><a href="#type-any.Any" class="anchor"></a><code><span>| </span><span><span class="constructor">Any</span> : <span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span> <a href="#type-any">any</a></span></code></td></tr></table></div><div class="spec-doc"><p>Type representation value with existential variable.</p></div></div><h2 id="basic-types"><a href="#basic-types" class="anchor"></a>Basic types</h2><div class="odoc-spec"><div class="spec value" id="val-unit" class="anchored"><a href="#val-unit" class="anchor"></a><code><span><span class="keyword">val</span> unit : <span>unit <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for unit values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int" class="anchored"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>int <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for integers.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int32" class="anchored"><a href="#val-int32" class="anchor"></a><code><span><span class="keyword">val</span> int32 : <span>int32 <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for the 32-bit integer type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int64" class="anchored"><a href="#val-int64" class="anchor"></a><code><span><span class="keyword">val</span> int64 : <span>int64 <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for the 64-bit integer type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-float" class="anchored"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span>float <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for the float type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bool" class="anchored"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for booleans.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-char" class="anchored"><a href="#val-char" class="anchor"></a><code><span><span class="keyword">val</span> char : <span>char <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for characters.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for strings.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bytes" class="anchored"><a href="#val-bytes" class="anchor"></a><code><span><span class="keyword">val</span> bytes : <span>bytes <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for bytes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-option" class="anchored"><a href="#val-option" class="anchor"></a><code><span><span class="keyword">val</span> option : <span><span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for option types.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-result" class="anchored"><a href="#val-result" class="anchor"></a><code><span><span class="keyword">val</span> result : <span><span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'e</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'e</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Runtime representation for result types.</p></div></div><h2 id="records"><a href="#records" class="anchor"></a>Records</h2><p>The following example demonstrates how to encode the runtime representation of a record:</p><pre><code>type book = { title : string; authors : string list; pages : int }

let book_t =
  let open Generics in
  let title_field = field &quot;title&quot; string (fun b -&gt; b.title) in
  let authors_field =
    field &quot;authors&quot; (list string) (fun b -&gt; b.authors)
  in
  let pages_field = field &quot;pages&quot; int (fun b -&gt; b.pages) in
  record &quot;book&quot; [ title_field; authors_field; pages_field ]
    (fun title authors pages -&gt; { title; authors; pages })</code></pre><div class="odoc-spec"><div class="spec module" id="module-Field" class="anchored"><a href="#module-Field" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Field/index.html">Field</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Definitions for runtime field representation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-field" class="anchored"><a href="#val-field" class="anchor"></a><code><span><span class="keyword">val</span> field : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span><span class="type-var">'record</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span class="type-var">'record</span>, <span class="type-var">'a</span> )</span> <a href="Field/index.html#type-t">Field.t</a></span></span></code></div><div class="spec-doc"><p><code>field name field_t get : ('record, 'a) Field.t</code> is the runtime representation of the field with type <code>'a</code>, represented by <code>field_t</code>, belonging to the record <code>'record</code>. See the <a href="Field/index.html"><code>Field</code></a> module for more operations on fields.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Record" class="anchored"><a href="#module-Record" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Record/index.html">Record</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Definitions for runtime record representation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-record" class="anchored"><a href="#val-record" class="anchor"></a><code><span><span class="keyword">val</span> record : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'record</span>, <span class="type-var">'make</span> )</span> <a href="Field/index.html#type-list">Field.list</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'make</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'record</span> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p><code>record name fields make</code> is the runtime representation of the record type with a given <code>name</code> and <code>fields</code>. The function <code>make</code> can be used to create the record value from field values. See the <a href="Record/index.html"><code>Record</code></a> module for more operations on records.</p></div></div><h2 id="variants"><a href="#variants" class="anchor"></a>Variants</h2><p>The following example demonstrates how to encode the runtime representation of the option type provided in the standard library.</p><pre><code>(* type 'a option = None | Some of 'a *)

let option_t t =
  let open Generics in
  let none_constr = constr &quot;None&quot; (Const None) in
  let some_constr = constr &quot;Some&quot; (Args (t, fun x -&gt; Some x)) in
  let value = function
    | None -&gt; Constr.Value (none_constr, ())
    | Some x -&gt; Constr.Value (some_constr, x)
  in
  variant &quot;option&quot;
    [ Constr.Any none_constr; Constr.Any some_constr ]
    value</code></pre><div class="odoc-spec"><div class="spec module" id="module-Constr" class="anchored"><a href="#module-Constr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Constr/index.html">Constr</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Definitions for runtime variant constructor representation. Constructors can either be constant or take one or more arguments.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-constr" class="anchored"><a href="#val-constr" class="anchor"></a><code><span><span class="keyword">val</span> constr : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'variant</span>, <span class="type-var">'args</span> )</span> <a href="Constr/index.html#type-make">Constr.make</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span class="type-var">'variant</span>, <span class="type-var">'args</span> )</span> <a href="Constr/index.html#type-t">Constr.t</a></span></span></code></div><div class="spec-doc"><p><code>constr name make : ('variant, 'args) Constr.t</code> is the runtime representation of the constructor with arguments of type <code>'args</code> belonging to the variant <code>'variant</code>.</p><p>The <code>make</code> argument is either <code>Const c</code>, for a constant constructor <code>c</code>, or <code>Args (args_t, variant_of_args)</code> that represents the constructor with arguments fo type <code>arg_t</code>, where <code>variant_of_args</code> is the function from constructor arguments to the variant value.</p><p>See the <a href="Constr/index.html"><code>Constr</code></a> module for more operations on constructors.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Variant" class="anchored"><a href="#module-Variant" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Variant/index.html">Variant</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Definitions for runtime variant representation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-variant" class="anchored"><a href="#val-variant" class="anchor"></a><code><span><span class="keyword">val</span> variant : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'variant</span> <a href="Constr/index.html#type-any">Constr.any</a></span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'variant</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'variant</span> <a href="Constr/index.html#type-value">Constr.value</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'variant</span> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Variant representation.</p><p><code>varinat name constr_list value</code> is the runtime representation of a variant type with constructors described by <code>constr_list</code> where <code>name</code> is the type name of the variant and <code>value</code> is a function that maps every variant constructor to its runtime representation as a <a href="Constr/index.html#type-value"><code>Constr.value</code></a>.</p></div></div><h2 id="abstract-types"><a href="#abstract-types" class="anchor"></a>Abstract types</h2><div class="odoc-spec"><div class="spec value" id="val-abstract" class="anchored"><a href="#val-abstract" class="anchor"></a><code><span><span class="keyword">val</span> abstract : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span></span></code></div></div><h2 id="dynamic-types"><a href="#dynamic-types" class="anchor"></a>Dynamic types</h2><div class="odoc-spec"><div class="spec module" id="module-Dyn" class="anchored"><a href="#module-Dyn" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Dyn/index.html">Dyn</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Definitions for values with runtime type representation.</p></div></div><h2 id="type-equality"><a href="#type-equality" class="anchor"></a>Type equality</h2><div class="odoc-spec"><div class="spec type" id="type-equal" class="anchored"><a href="#type-equal" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b) equal</span></span><span> = </span></code><table><tr id="type-equal.Equal" class="anchored"><td class="def variant constructor"><a href="#type-equal.Equal" class="anchor"></a><code><span>| </span><span><span class="constructor">Equal</span> : <span><span>( <span class="type-var">'a</span>, <span class="type-var">'a</span> )</span> <a href="#type-equal">equal</a></span></span></code></td></tr></table></div><div class="spec-doc"><p>The type for equality between <code>typ</code> values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-equal" class="anchored"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span> )</span> <a href="#type-equal">equal</a></span> option</span></span></code></div><div class="spec-doc"><p>Checks for equality between two type representations.</p></div></div><h2 id="mapper"><a href="#mapper" class="anchor"></a>Mapper</h2><p>Mappers are datatype-generic interpreters. The most common examples of mappers provide functionality such as generic comparision or printing of values.</p><h3 id="custom-mappers"><a href="#custom-mappers" class="anchor"></a>Custom mappers</h3><p>The <a href="Map/index.html"><code>Map</code></a> functor can be used to create user-defined generic mappers. The <a href="module-type-Mapper/index.html"><code>Mapper</code></a> module type describes the required implementation of a mapper.</p><p>Every mapper needs to provide two types that represent the mapping and the conversion functions for each data type. The following example demonstrates this by implementing a simple mapper to convert values to strings:</p><pre><code>module String_mapper = Generic.Map (struct
  (* The target mapping type from a value to a string. *)
  type 'a t = 'a -&gt; string

  (* The type of the generic mapper. This is the type of the [self]
     argument passed to polymorphic mapping functions like [variant] and
     [record]. *)
  type mapper = { map : 'a. 'a typ -&gt; 'a t }

  (* Mapping functions for basic types. *)
  let unit () = &quot;()&quot;
  let int = string_of_int
  let int32 = Int32.to_string
  let int64 = Int64.to_string
  let float = string_of_float
  let bool = string_of_bool
  let char = String.make 1
  let string x = String.concat &quot;&quot; [ &quot;\&quot;&quot;; String.escaped x; &quot;\&quot;&quot; ]
  let bytes x = string (Bytes.to_string x)

  (* Mapping function for records. *)
  let record self record_t r1 =
    let fields =
      record_t
      |&gt; Generics.Record.any_field_list
      |&gt; List.map (fun (Generics.Field.Any field) -&gt;
             let typ = Generics.Field.typ field in
             let show = self.map typ in
             let v = Generics.Field.get r1 field in
             String.concat &quot;&quot;
               [ &quot;  &quot;; Generics.Field.name field; &quot; = &quot;; show v; &quot;;&quot; ])
      |&gt; String.concat &quot;\n&quot;
    in
    String.concat &quot;\n&quot; [ &quot;{ &quot;; fields; &quot;}&quot; ]

  (* Mapping function for variants. *)
  let variant self variant_t variant =
    let (Generics.Constr.Value (constr, args)) =
      Generics.Variant.value variant_t variant
    in
    let constr_name = Generics.Constr.name constr in
    match Generics.Constr.make constr with
    | Const _ -&gt; constr_name
    | Args (args_t, _) -&gt;
      let show_args = self.map args_t args in
      String.concat &quot; &quot; [ constr_name; &quot;(&quot;; show_args; &quot;)&quot; ]

  (* Mapping function for abstract types. *)
  let abstract name _ = String.concat &quot;&quot; [ &quot;&lt;&quot;; name; &quot;&gt;&quot; ]
end)</code></pre><p>The <code>String_mapper</code> module can now be used to convert any generic type to a string:</p><pre><code># String_mapper.map Generic.int 42;;
- : string = &quot;42&quot;

# String_mapper.map Generic.(option bool) (Some true);;
- : string = &quot;Some (true)&quot;</code></pre><p>In addition to working on builtin types, <code>String_mapper</code> can be extended to work on abstract or user-defined types:</p><pre><code>(* Define an abstract type and register a mapping function. *)
let out_channel_t : out_channel Generics.typ = Generics.abstract &quot;out_channel&quot; in
String_mapper.register out_channel_t
  (fun oc -&gt; if oc = stdout then &quot;&lt;stdout&gt;&quot;
    else if oc = stderr then &quot;&lt;stderr&gt;&quot; else &quot;&lt;out_channel&gt;&quot;);;

(* Call the generic mapper with our custom type. *)
# String_mapper.map out_channel_t stderr
- : string = &quot;&lt;stderr&gt;&quot;</code></pre><div class="odoc-spec"><div class="spec module-type" id="module-type-Mapper" class="anchored"><a href="#module-type-Mapper" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Mapper/index.html">Mapper</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Map" class="anchored"><a href="#module-Map" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Map/index.html">Map</a></span><span> (<a href="Map/argument-1-Mapper/index.html">Mapper</a> : <a href="module-type-Mapper/index.html">Mapper</a>) : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>